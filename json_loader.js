/**
 * –ó–∞–≥—Ä—É–∑—á–∏–∫ –¥–∞–Ω–Ω—ã—Ö –∏–∑ JSON —Ñ–∞–π–ª–∞
 * –ü–æ–∑–≤–æ–ª—è–µ—Ç –∑–∞–≥—Ä—É–∂–∞—Ç—å –º–µ–Ω—é –∏–∑ menu_data.json
 */

class JSONMenuLoader {
    constructor() {
        this.menuData = {};
        this.fallbackData = this.createFallbackData();
    }

    /**
     * –ó–∞–≥—Ä—É–∂–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –∏–∑ –≤—Å—Ç—Ä–æ–µ–Ω–Ω–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞ –∏–ª–∏ JSON —Ñ–∞–π–ª–∞
     */
    async loadMenuFromJSON() {
        try {
            console.log('üîÑ –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...');
            
            let data = null;
            const isFileProtocol = typeof window !== 'undefined' && window.location && window.location.protocol === 'file:';
            
            // –ï—Å–ª–∏ –æ—Ç–∫—Ä—ã—Ç–æ –Ω–∞–ø—Ä—è–º—É—é —á–µ—Ä–µ–∑ file:// ‚Äî –∏—Å–ø–æ–ª—å–∑—É–µ–º –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å CORS
            if (isFileProtocol && window.EMBEDDED_MENU_DATA) {
                console.log('üìÅ –ó–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ file:// ‚Äî –∏—Å–ø–æ–ª—å–∑—É–µ–º EMBEDDED_MENU_DATA');
                data = window.EMBEDDED_MENU_DATA;
            } else {
                // –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: menu_data.json -> menu_data_accurate.json -> EMBEDDED_MENU_DATA
                console.log('üì• –ü—Ä–æ–±—É–µ–º –∑–∞–≥—Ä—É–∑–∏—Ç—å menu_data.json...');
                try {
                    let response = await fetch(`menu_data.json?ts=${Date.now()}`);
                    if (!response.ok) {
                        console.log('‚ö†Ô∏è menu_data.json –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω, –ø—Ä–æ–±—É–µ–º menu_data_accurate.json...');
                        response = await fetch(`menu_data_accurate.json?ts=${Date.now()}`);
                    }
                    if (response.ok) {
                        data = await response.json();
                    } else if (window.EMBEDDED_MENU_DATA) {
                        console.log('‚ÑπÔ∏è –ò—Å–ø–æ–ª—å–∑—É–µ–º –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ EMBEDDED_MENU_DATA –∫–∞–∫ –∑–∞–ø–∞—Å–Ω–æ–π –≤–∞—Ä–∏–∞–Ω—Ç');
                        data = window.EMBEDDED_MENU_DATA;
                    } else {
                        throw new Error(`–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ (HTTP ${response.status})`);
                    }
                } catch (e) {
                    // –û—à–∏–±–∫–∞ —Å–µ—Ç–∏/–ø—Ä–æ—Ç–æ–∫–æ–ª–∞ ‚Äî –ø—Ä–æ–±—É–µ–º –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
                    if (window.EMBEDDED_MENU_DATA) {
                        console.log('üåê –û—à–∏–±–∫–∞ fetch, –∏—Å–ø–æ–ª—å–∑—É–µ–º EMBEDDED_MENU_DATA –∫–∞–∫ –∑–∞–ø–∞—Å–Ω–æ–π –≤–∞—Ä–∏–∞–Ω—Ç');
                        data = window.EMBEDDED_MENU_DATA;
                    } else {
                        throw e;
                    }
                }
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –¥–∞–Ω–Ω—ã–µ
            const hasData = Object.values(data).some(shift => 
                (shift.days && shift.days.length > 0) || 
                (shift.weeks && shift.weeks.length > 0)
            );
            
            if (hasData) {
                this.menuData = data;
                console.log('‚úÖ –î–∞–Ω–Ω—ã–µ —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω—ã');
                console.log('üìä –ü–µ—Ä–≤–∞—è —Å–º–µ–Ω–∞, –ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫, –∑–∞–≤—Ç—Ä–∞–∫:', 
                    data.first?.weeks?.[0]?.days?.[0]?.meals?.–∑–∞–≤—Ç—Ä–∞–∫ || '–ù–µ –Ω–∞–π–¥–µ–Ω–æ');
            } else {
                console.log('‚ö†Ô∏è –î–∞–Ω–Ω—ã–µ –ø—É—Å—Ç—ã');
                this.showError('–î–∞–Ω–Ω—ã–µ –∏–∑ Excel —Ñ–∞–π–ª–æ–≤ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã');
                return;
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ
            this.updateMenuDisplay();
            
        } catch (error) {
            console.log('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏:', error.message);
            this.showError('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö: ' + error.message);
        }
    }

    /**
     * –û–±–Ω–æ–≤–ª—è–µ—Ç –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –º–µ–Ω—é –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ
     */
    updateMenuDisplay() {
        Object.keys(this.menuData).forEach(shiftType => {
            const container = document.getElementById(`${shiftType}-shift`);
            if (!container) return;

            const weekGrid = container.querySelector('.week-grid');
            if (!weekGrid) return;

            // –û—á–∏—â–∞–µ–º —Ç–µ–∫—É—â–∏–π –∫–æ–Ω—Ç–µ–Ω—Ç
            weekGrid.innerHTML = '';

            const shiftData = this.menuData[shiftType];
            // –í—Å–µ–≥–¥–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–ª–æ—Å–∫–∏–π —Å–ø–∏—Å–æ–∫ –¥–Ω–µ–π –ø–æ –¥–∞—Ç–∞–º (–±–µ–∑ –Ω–µ–¥–µ–ª—å)
            let days = [];
            if (Array.isArray(shiftData?.weeks) && shiftData.weeks.length > 0) {
                shiftData.weeks.forEach(week => {
                    if (Array.isArray(week.days)) {
                        days.push(...week.days);
                    }
                });
            } else if (Array.isArray(shiftData?.days)) {
                days = shiftData.days.slice();
            }

            // –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ –¥–∞—Ç–µ, –µ—Å–ª–∏ –≤–æ–∑–º–æ–∂–Ω–æ
            const parseDateKey = (d) => {
                const raw = (d?.date || '').toString().trim().toLowerCase();
                // –ü–æ–ø—ã—Ç–∫–∞ —Ä–∞—Å–ø–æ–∑–Ω–∞—Ç—å d.m(.yyyy)
                const m1 = raw.match(/^(\d{1,2})\.(\d{1,2})(?:\.(\d{2,4}))?$/);
                if (m1) {
                    const day = parseInt(m1[1], 10);
                    const mon = parseInt(m1[2], 10);
                    const year = m1[3] ? parseInt(m1[3], 10) : 0;
                    return year * 10000 + mon * 100 + day;
                }
                // d month
                const months = ['—è–Ω–≤','—Ñ–µ–≤','–º–∞—Ä','–∞–ø—Ä','–º–∞','–∏—é–Ω','–∏—é–ª','–∞–≤–≥','—Å–µ–Ω','—Å–µ–Ω—Ç','–æ–∫—Ç','–Ω–æ—è','–Ω–æ—è–±','–¥–µ–∫'];
                const m2 = raw.match(/^(\d{1,2})\s+([–∞-—è.]+)(?:\s+(\d{4}))?$/i);
                if (m2) {
                    const day = parseInt(m2[1], 10);
                    const monTxt = m2[2].replace('.', '');
                    const year = m2[3] ? parseInt(m2[3], 10) : 0;
                    let monIdx = months.findIndex(m => monTxt.startsWith(m));
                    if (monIdx >= 0) {
                        // –Ω–æ—Ä–º–∞–ª–∏–∑—É–µ–º: '–º–∞' –¥–ª—è –º–∞—è –∫–æ–Ω—Ñ–ª–∏–∫—Ç—É–µ—Ç —Å '–º–∞–π/–º–∞—è', –∫–æ–º–ø–µ–Ω—Å–∏—Ä—É–µ–º
                        if (monTxt.startsWith('–º–∞') && monTxt.length > 2) {
                            monIdx = 4; // –º–∞–π
                        }
                        const mon = [1,2,3,4,5,6,7,8,9,9,10,11,11][monIdx] || 0;
                        return year * 10000 + mon * 100 + day;
                    }
                }
                // iso yyyy-mm-dd
                const m3 = raw.match(/^(\d{4})-(\d{2})-(\d{2})$/);
                if (m3) {
                    return parseInt(m3[1], 10) * 10000 + parseInt(m3[2], 10) * 100 + parseInt(m3[3], 10);
                }
                // –§–æ–ª–ª–±–µ–∫ ‚Äî –æ—Å—Ç–∞–≤–ª—è–µ–º –ø–æ—Ä—è–¥–æ–∫ –∫–∞–∫ –µ—Å—Ç—å
                return Number.MAX_SAFE_INTEGER;
            };

            days.sort((a, b) => parseDateKey(a) - parseDateKey(b));

            // –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ø–æ –Ω–µ–¥–µ–ª—è–º: –Ω–æ–≤–∞—è –Ω–µ–¥–µ–ª—è –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å –ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫–∞
            let groups = [];
            let currentGroup = [];
            let weekIndex = 0;
            const flushGroup = () => {
                if (currentGroup.length > 0) {
                    // –ó–∞–≥–æ–ª–æ–≤–æ–∫ –Ω–µ–¥–µ–ª–∏ (–∂–∏—Ä–Ω—ã–π)
                    const weekHeader = document.createElement('div');
                    weekHeader.className = 'week-header';
                    weekIndex += 1;
                    weekHeader.innerHTML = `<strong>–ù–µ–¥–µ–ª—è ${weekIndex}</strong>`;
                    weekGrid.appendChild(weekHeader);
                    currentGroup.forEach(d => {
                        const dayCard = this.createDayCard(d);
                        weekGrid.appendChild(dayCard);
                    });
                    currentGroup = [];
                }
            };

            days.forEach(d => {
                const isMonday = (d?.day || '').toLowerCase() === '–ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫';
                if (isMonday && currentGroup.length > 0) {
                    flushGroup();
                }
                currentGroup.push(d);
            });
            flushGroup();
        });

        console.log('‚úÖ –ú–µ–Ω—é –æ–±–Ω–æ–≤–ª–µ–Ω–æ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ');
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
        this.showNotification('üìä –ú–µ–Ω—é –æ–±–Ω–æ–≤–ª–µ–Ω–æ!', 'success');
    }

    /**
     * –°–æ–∑–¥–∞–µ—Ç HTML –∫–∞—Ä—Ç–æ—á–∫—É –¥–Ω—è
     */
    createDayCard(dayData) {
        const dayCard = document.createElement('div');
        dayCard.className = 'day-card';

        const mealsHTML = Object.entries(dayData.meals).map(([mealType, dishes]) => {
            const dishesHTML = dishes.map(dish => {
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ dish –æ–±—ä–µ–∫—Ç–æ–º —Å –∫–∞–ª–æ—Ä–∏–π–Ω–æ—Å—Ç—å—é –∏–ª–∏ –ø—Ä–æ—Å—Ç–æ —Å—Ç—Ä–æ–∫–æ–π
                if (typeof dish === 'object' && dish.name) {
                    const caloriesText = dish.calories ? ` <span class="calories">(${dish.calories} –∫–∫–∞–ª)</span>` : '';
                    return `<li>${dish.name}${caloriesText}</li>`;
                } else {
                    return `<li>${dish}</li>`;
                }
            }).join('');
            
            return `
                <div class="meal">
                    <h4 class="meal-type">${this.capitalize(mealType)}</h4>
                    <ul class="meal-items">
                        ${dishesHTML}
                    </ul>
                </div>
            `;
        }).join('');

        dayCard.innerHTML = `
            <div class="day-header">
                <h3>${dayData.day}</h3>
                ${dayData.date ? `<span class="date">${dayData.date}</span>` : ''}
            </div>
            <div class="meals">
                ${mealsHTML}
            </div>
        `;

        return dayCard;
    }

    /**
     * –°–æ–∑–¥–∞–µ—Ç —Ä–µ–∑–µ—Ä–≤–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏
     */
    createFallbackData() {
        return {
            first: {
                shift_type: 'first',
                shift_name: '–ü–µ—Ä–≤–∞—è —Å–º–µ–Ω–∞',
                days: [
                    {
                        day: '–ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫',
                        date: '2 —Å–µ–Ω—Ç—è–±—Ä—è',
                        meals: {
                            –∑–∞–≤—Ç—Ä–∞–∫: [
                                {name: '–ö–∞—à–∞ –æ–≤—Å—è–Ω–∞—è –º–æ–ª–æ—á–Ω–∞—è —Å –º–∞—Å–ª–æ–º —Å–ª–∏–≤–æ—á–Ω—ã–º', calories: 180},
                                {name: '–ë—É—Ç–µ—Ä–±—Ä–æ–¥ —Å –º–∞—Å–ª–æ–º —Å–ª–∏–≤–æ—á–Ω—ã–º', calories: 145},
                                {name: '–ß–∞–π —Å —Å–∞—Ö–∞—Ä–æ–º', calories: 35},
                                {name: '–•–ª–µ–± –ø—à–µ–Ω–∏—á–Ω—ã–π', calories: 85}
                            ],
                            –æ–±–µ–¥: [
                                {name: '–ë–æ—Ä—â —Å–æ —Å–º–µ—Ç–∞–Ω–æ–π', calories: 125},
                                {name: '–ö–æ—Ç–ª–µ—Ç–∞ –∫—É—Ä–∏–Ω–∞—è –ø–∞—Ä–æ–≤–∞—è', calories: 210},
                                {name: '–ü—é—Ä–µ –∫–∞—Ä—Ç–æ—Ñ–µ–ª—å–Ω–æ–µ', calories: 95},
                                {name: '–°–∞–ª–∞—Ç –∏–∑ —Å–≤–µ–∂–µ–π –∫–∞–ø—É—Å—Ç—ã', calories: 45},
                                {name: '–ö–æ–º–ø–æ—Ç –∏–∑ —Å—É—Ö–æ—Ñ—Ä—É–∫—Ç–æ–≤', calories: 65},
                                {name: '–•–ª–µ–± —Ä–∂–∞–Ω–æ–π', calories: 75}
                            ]
                        }
                    },
                    {
                        day: '–í—Ç–æ—Ä–Ω–∏–∫',
                        date: '3 —Å–µ–Ω—Ç—è–±—Ä—è',
                        meals: {
                            –∑–∞–≤—Ç—Ä–∞–∫: [
                                '–ö–∞—à–∞ —Ä–∏—Å–æ–≤–∞—è –º–æ–ª–æ—á–Ω–∞—è —Å –∏–∑—é–º–æ–º',
                                '–Ø–π—Ü–æ –∫—É—Ä–∏–Ω–æ–µ –≤–∞—Ä–µ–Ω–æ–µ',
                                '–ö–∞–∫–∞–æ –Ω–∞ –º–æ–ª–æ–∫–µ',
                                '–•–ª–µ–± –ø—à–µ–Ω–∏—á–Ω—ã–π —Å –º–∞—Å–ª–æ–º'
                            ],
                            –æ–±–µ–¥: [
                                '–°—É–ø –≥–æ—Ä–æ—Ö–æ–≤—ã–π —Å –º—è—Å–æ–º',
                                '–†—ã–±–∞ –∑–∞–ø–µ—á–µ–Ω–Ω–∞—è —Å –æ–≤–æ—â–∞–º–∏',
                                '–†–∏—Å –æ—Ç–≤–∞—Ä–Ω–æ–π —Ä–∞—Å—Å—ã–ø—á–∞—Ç—ã–π',
                                '–°–∞–ª–∞—Ç –≤–∏—Ç–∞–º–∏–Ω–Ω—ã–π',
                                '–°–æ–∫ —è–±–ª–æ—á–Ω—ã–π –Ω–∞—Ç—É—Ä–∞–ª—å–Ω—ã–π',
                                '–•–ª–µ–± —Ä–∂–∞–Ω–æ–π'
                            ]
                        }
                    },
                    {
                        day: '–°—Ä–µ–¥–∞',
                        date: '4 —Å–µ–Ω—Ç—è–±—Ä—è',
                        meals: {
                            –∑–∞–≤—Ç—Ä–∞–∫: [
                                '–ö–∞—à–∞ –≥—Ä–µ—á–Ω–µ–≤–∞—è —Å –º–æ–ª–æ–∫–æ–º',
                                '–°–æ—Å–∏—Å–∫–∞ –º–æ–ª–æ—á–Ω–∞—è –æ—Ç–≤–∞—Ä–Ω–∞—è',
                                '–ß–∞–π —Å –ª–∏–º–æ–Ω–æ–º –∏ —Å–∞—Ö–∞—Ä–æ–º',
                                '–•–ª–µ–± –ø—à–µ–Ω–∏—á–Ω—ã–π'
                            ],
                            –æ–±–µ–¥: [
                                '–©–∏ –∏–∑ —Å–≤–µ–∂–µ–π –∫–∞–ø—É—Å—Ç—ã',
                                '–ì—É–ª—è—à –≥–æ–≤—è–∂–∏–π —Ç—É—à–µ–Ω—ã–π',
                                '–ú–∞–∫–∞—Ä–æ–Ω—ã –æ—Ç–≤–∞—Ä–Ω—ã–µ',
                                '–°–∞–ª–∞—Ç –∏–∑ –º–æ—Ä–∫–æ–≤–∏ —Å —è–±–ª–æ–∫–æ–º',
                                '–ö–∏—Å–µ–ª—å —è–≥–æ–¥–Ω—ã–π',
                                '–•–ª–µ–± —Ä–∂–∞–Ω–æ–π'
                            ]
                        }
                    },
                    {
                        day: '–ß–µ—Ç–≤–µ—Ä–≥',
                        date: '5 —Å–µ–Ω—Ç—è–±—Ä—è',
                        meals: {
                            –∑–∞–≤—Ç—Ä–∞–∫: [
                                '–û–º–ª–µ—Ç –Ω–∞—Ç—É—Ä–∞–ª—å–Ω—ã–π',
                                '–•–ª–µ–± —Å –¥–∂–µ–º–æ–º –∞–±—Ä–∏–∫–æ—Å–æ–≤—ã–º',
                                '–ú–æ–ª–æ–∫–æ –ø–∞—Å—Ç–µ—Ä–∏–∑–æ–≤–∞–Ω–Ω–æ–µ',
                                '–ú–∞—Å–ª–æ —Å–ª–∏–≤–æ—á–Ω–æ–µ'
                            ],
                            –æ–±–µ–¥: [
                                '–°—É–ø –∫—É—Ä–∏–Ω—ã–π —Å –¥–æ–º–∞—à–Ω–µ–π –ª–∞–ø—à–æ–π',
                                '–¢–µ—Ñ—Ç–µ–ª–∏ –º—è—Å–Ω—ã–µ –≤ —Ç–æ–º–∞—Ç–Ω–æ–º —Å–æ—É—Å–µ',
                                '–ì—Ä–µ—á–∫–∞ –æ—Ç–≤–∞—Ä–Ω–∞—è —Ä–∞—Å—Å—ã–ø—á–∞—Ç–∞—è',
                                '–°–∞–ª–∞—Ç –∏–∑ —Å–≤–µ–∂–∏—Ö –æ–≥—É—Ä—Ü–æ–≤',
                                '–ö–æ–º–ø–æ—Ç –∏–∑ —Å–≤–µ–∂–∏—Ö —è–±–ª–æ–∫',
                                '–•–ª–µ–± —Ä–∂–∞–Ω–æ–π'
                            ]
                        }
                    },
                    {
                        day: '–ü—è—Ç–Ω–∏—Ü–∞',
                        date: '6 —Å–µ–Ω—Ç—è–±—Ä—è',
                        meals: {
                            –∑–∞–≤—Ç—Ä–∞–∫: [
                                '–ö–∞—à–∞ –ø—à–µ–Ω–Ω–∞—è –º–æ–ª–æ—á–Ω–∞—è',
                                '–¢–≤–æ—Ä–æ–≥ —Å–æ —Å–º–µ—Ç–∞–Ω–æ–π',
                                '–ß–∞–π —Å –º–µ–¥–æ–º –Ω–∞—Ç—É—Ä–∞–ª—å–Ω—ã–º',
                                '–ü–µ—á–µ–Ω—å–µ –æ–≤—Å—è–Ω–æ–µ'
                            ],
                            –æ–±–µ–¥: [
                                '–°–æ–ª—è–Ω–∫–∞ –º—è—Å–Ω–∞—è —Å–±–æ—Ä–Ω–∞—è',
                                '–ö—É—Ä–∏—Ü–∞ –æ—Ç–≤–∞—Ä–Ω–∞—è –¥–∏–µ—Ç–∏—á–µ—Å–∫–∞—è',
                                '–ö–∞—Ä—Ç–æ—Ñ–µ–ª—å –æ—Ç–≤–∞—Ä–Ω–æ–π —Å —É–∫—Ä–æ–ø–æ–º',
                                '–°–∞–ª–∞—Ç –∏–∑ –æ—Ç–≤–∞—Ä–Ω–æ–π —Å–≤–µ–∫–ª—ã',
                                '–ú–æ—Ä—Å –∫–ª—é–∫–≤–µ–Ω–Ω—ã–π',
                                '–•–ª–µ–± —Ä–∂–∞–Ω–æ–π'
                            ]
                        }
                    }
                ]
            },
            second: {
                shift_type: 'second',
                shift_name: '–í—Ç–æ—Ä–∞—è —Å–º–µ–Ω–∞',
                days: [
                    {
                        day: '–ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫',
                        date: '2 —Å–µ–Ω—Ç—è–±—Ä—è',
                        meals: {
                            –æ–±–µ–¥: [
                                '–°—É–ø –æ–≤–æ—â–Ω–æ–π —Å –±—Ä–æ–∫–∫–æ–ª–∏',
                                '–ö–æ—Ç–ª–µ—Ç—ã —Ä—ã–±–Ω—ã–µ –ø–∞—Ä–æ–≤—ã–µ',
                                '–†–∏—Å —Å –æ–≤–æ—â–∞–º–∏ —Ç—É—à–µ–Ω—ã–º–∏',
                                '–°–∞–ª–∞—Ç –≤–∏—Ç–∞–º–∏–Ω–Ω—ã–π –∏–∑ –∫–∞–ø—É—Å—Ç—ã',
                                '–ö–æ–º–ø–æ—Ç –∏–∑ —Å—É—Ö–æ—Ñ—Ä—É–∫—Ç–æ–≤',
                                '–•–ª–µ–± —Ä–∂–∞–Ω–æ–π'
                            ],
                            –ø–æ–ª–¥–Ω–∏–∫: [
                                '–ë—É–ª–æ—á–∫–∞ —Å –ø–æ–≤–∏–¥–ª–æ–º –¥–æ–º–∞—à–Ω–∏–º',
                                '–ú–æ–ª–æ–∫–æ —Ç–æ–ø–ª–µ–Ω–æ–µ',
                                '–Ø–±–ª–æ–∫–æ —Å–≤–µ–∂–µ–µ',
                                '–û—Ä–µ—Ö–∏ –≥—Ä–µ—Ü–∫–∏–µ'
                            ]
                        }
                    },
                    {
                        day: '–í—Ç–æ—Ä–Ω–∏–∫',
                        date: '3 —Å–µ–Ω—Ç—è–±—Ä—è',
                        meals: {
                            –æ–±–µ–¥: [
                                '–ë–æ—Ä—â —É–∫—Ä–∞–∏–Ω—Å–∫–∏–π —Å–æ —Å–º–µ—Ç–∞–Ω–æ–π',
                                '–ö–æ—Ç–ª–µ—Ç–∞ —Å–≤–∏–Ω–∞—è –Ω–∞ –ø–∞—Ä—É',
                                '–ü—é—Ä–µ –∫–∞—Ä—Ç–æ—Ñ–µ–ª—å–Ω–æ–µ —Å –º–∞—Å–ª–æ–º',
                                '–°–∞–ª–∞—Ç –∏–∑ –ø–æ–º–∏–¥–æ—Ä–æ–≤ –∏ –æ–≥—É—Ä—Ü–æ–≤',
                                '–°–æ–∫ –∞–ø–µ–ª—å—Å–∏–Ω–æ–≤—ã–π –Ω–∞—Ç—É—Ä–∞–ª—å–Ω—ã–π',
                                '–•–ª–µ–± —Ä–∂–∞–Ω–æ–π'
                            ],
                            –ø–æ–ª–¥–Ω–∏–∫: [
                                '–ü–µ—á–µ–Ω—å–µ –æ–≤—Å—è–Ω–æ–µ –¥–æ–º–∞—à–Ω–µ–µ',
                                '–ô–æ–≥—É—Ä—Ç –Ω–∞—Ç—É—Ä–∞–ª—å–Ω—ã–π',
                                '–ë–∞–Ω–∞–Ω —Å–ø–µ–ª—ã–π',
                                '–ß–∞–π —Ç—Ä–∞–≤—è–Ω–æ–π'
                            ]
                        }
                    },
                    {
                        day: '–°—Ä–µ–¥–∞',
                        date: '4 —Å–µ–Ω—Ç—è–±—Ä—è',
                        meals: {
                            –æ–±–µ–¥: [
                                '–†–∞—Å—Å–æ–ª—å–Ω–∏–∫ —Å –ø–µ—Ä–ª–æ–≤–∫–æ–π',
                                '–ö—É—Ä–∏—Ü–∞ –∑–∞–ø–µ—á–µ–Ω–Ω–∞—è —Å —Ç—Ä–∞–≤–∞–º–∏',
                                '–ì—Ä–µ—á–∫–∞ —Ä–∞—Å—Å—ã–ø—á–∞—Ç–∞—è —Å –º–∞—Å–ª–æ–º',
                                '–°–∞–ª–∞—Ç –∏–∑ –±–µ–ª–æ–∫–æ—á–∞–Ω–Ω–æ–π –∫–∞–ø—É—Å—Ç—ã',
                                '–ö–∏—Å–µ–ª—å –≤–∏—à–Ω–µ–≤—ã–π',
                                '–•–ª–µ–± —Ä–∂–∞–Ω–æ–π'
                            ],
                            –ø–æ–ª–¥–Ω–∏–∫: [
                                '–°—ã—Ä–Ω–∏–∫–∏ —Ç–≤–æ—Ä–æ–∂–Ω—ã–µ',
                                '–°–º–µ—Ç–∞–Ω–∞ –¥–æ–º–∞—à–Ω—è—è',
                                '–ß–∞–π —Å –º—è—Ç–æ–π',
                                '–ú–µ–¥ —Ü–≤–µ—Ç–æ—á–Ω—ã–π'
                            ]
                        }
                    },
                    {
                        day: '–ß–µ—Ç–≤–µ—Ä–≥',
                        date: '5 —Å–µ–Ω—Ç—è–±—Ä—è',
                        meals: {
                            –æ–±–µ–¥: [
                                '–°—É–ø –º–æ–ª–æ—á–Ω—ã–π —Å –≤–µ—Ä–º–∏—à–µ–ª—å—é',
                                '–ë–∏—Ç–æ—á–∫–∏ —Ä—ã–±–Ω—ã–µ –∑–∞–ø–µ—á–µ–Ω–Ω—ã–µ',
                                '–ú–∞–∫–∞—Ä–æ–Ω—ã —Ç–≤–µ—Ä–¥—ã—Ö —Å–æ—Ä—Ç–æ–≤',
                                '–°–∞–ª–∞—Ç –æ–≥—É—Ä–µ—á–Ω—ã–π —Å –∑–µ–ª–µ–Ω—å—é',
                                '–ö–æ–º–ø–æ—Ç —è–±–ª–æ—á–Ω—ã–π –¥–æ–º–∞—à–Ω–∏–π',
                                '–•–ª–µ–± —Ä–∂–∞–Ω–æ–π'
                            ],
                            –ø–æ–ª–¥–Ω–∏–∫: [
                                '–ö–µ–∫—Å –¥–æ–º–∞—à–Ω–∏–π —Å –∏–∑—é–º–æ–º',
                                '–ö–∞–∫–∞–æ –Ω–∞ –º–æ–ª–æ–∫–µ',
                                '–Ø–±–ª–æ–∫–æ –∑–∞–ø–µ—á–µ–Ω–Ω–æ–µ',
                                '–ö–æ—Ä–∏—Ü–∞ –º–æ–ª–æ—Ç–∞—è'
                            ]
                        }
                    },
                    {
                        day: '–ü—è—Ç–Ω–∏—Ü–∞',
                        date: '6 —Å–µ–Ω—Ç—è–±—Ä—è',
                        meals: {
                            –æ–±–µ–¥: [
                                '–©–∏ –∫–∏—Å–ª—ã–µ —Å –º—è—Å–æ–º',
                                '–¢–µ—Ñ—Ç–µ–ª–∏ –≤ —Å–º–µ—Ç–∞–Ω–Ω–æ–º —Å–æ—É—Å–µ',
                                '–†–∏—Å –æ—Ç–≤–∞—Ä–Ω–æ–π —Å –∑–µ–ª–µ–Ω—å—é',
                                '–°–∞–ª–∞—Ç –º–æ—Ä–∫–æ–≤–Ω—ã–π —Å –º–µ–¥–æ–º',
                                '–ú–æ—Ä—Å –±—Ä—É—Å–Ω–∏—á–Ω—ã–π',
                                '–•–ª–µ–± —Ä–∂–∞–Ω–æ–π'
                            ],
                            –ø–æ–ª–¥–Ω–∏–∫: [
                                '–ó–∞–ø–µ–∫–∞–Ω–∫–∞ —Ç–≤–æ—Ä–æ–∂–Ω–∞—è',
                                '–ú–æ–ª–æ–∫–æ –ø–∞—Å—Ç–µ—Ä–∏–∑–æ–≤–∞–Ω–Ω–æ–µ',
                                '–ì—Ä—É—à–∞ —Å–≤–µ–∂–∞—è',
                                '–í–∞—Ä–µ–Ω—å–µ –¥–æ–º–∞—à–Ω–µ–µ'
                            ]
                        }
                    }
                ]
            }
        };
    }

    /**
     * –£—Ç–∏–ª–∏—Ç–∞ –¥–ª—è –∫–∞–ø–∏—Ç–∞–ª–∏–∑–∞—Ü–∏–∏ —Å—Ç—Ä–æ–∫–∏
     */
    capitalize(str) {
        return str.charAt(0).toUpperCase() + str.slice(1);
    }

    /**
     * –ü–æ–∫–∞–∑–∞—Ç—å –æ—à–∏–±–∫—É
     */
    showError(message) {
        console.error('‚ùå', message);
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –æ—à–∏–±–∫—É –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ
        const containers = document.querySelectorAll('.week-grid');
        containers.forEach(container => {
            container.innerHTML = `
                <div class="error-message">
                    <h3>‚ö†Ô∏è –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö</h3>
                    <p>${message}</p>
                    <p>–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ –¥–ª—è –ø–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–µ–π.</p>
                </div>
            `;
        });
    }

    /**
     * –ü–æ–∫–∞–∑–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
     */
    showNotification(message, type = 'info') {
        // –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ñ—É–Ω–∫—Ü–∏—é –∏–∑ excel_reader.js –µ—Å–ª–∏ –æ–Ω–∞ –¥–æ—Å—Ç—É–ø–Ω–∞
        if (typeof showNotification === 'function') {
            showNotification(message, type);
        } else {
            console.log(`${type.toUpperCase()}: ${message}`);
        }
    }
}

// –ì–ª–æ–±–∞–ª—å–Ω—ã–π —ç–∫–∑–µ–º–ø–ª—è—Ä –∑–∞–≥—Ä—É–∑—á–∏–∫–∞
window.jsonLoader = new JSONMenuLoader();

// –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
document.addEventListener('DOMContentLoaded', function() {
    // –ù–µ–±–æ–ª—å—à–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ —á—Ç–æ–±—ã –¥–∞—Ç—å –≤—Ä–µ–º—è –¥—Ä—É–≥–∏–º —Å–∫—Ä–∏–ø—Ç–∞–º –∑–∞–≥—Ä—É–∑–∏—Ç—å—Å—è
    setTimeout(() => {
        window.jsonLoader.loadMenuFromJSON();
    }, 500);
});
